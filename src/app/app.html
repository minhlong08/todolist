<main class="todo-container">
  <h1 class="app-title">My Todo List</h1>
  
  <div class="add-task">
    <input 
      type="text" 
      [(ngModel)]="newTask"
      placeholder="What needs to be done?"
      (keyup.enter)="addTask(newTask); newTask = ''"
    >
    <button 
      class="add-btn" 
      (click)="addTask(newTask); newTask = ''"
      [disabled]="!newTask?.trim()"
    >
      Add Task
    </button>
  </div>
  
  <ul class="task-list" *ngIf="todoList.length > 0">
    <li 
      *ngFor="let todoItem of todoList; trackBy: trackByFn" 
      class="task-item"
      [class.completed]="todoItem.completed"
    >
      <input
        type="checkbox"
        class="task-checkbox"
        [checked]="todoItem.completed"
        (change)="toggleCompleted(todoItem.id)"
      />
      <span 
        class="task-text"
        [class.completed]="todoItem.completed"
      >
        {{ todoItem.task }}
      </span>
      <button 
        class="delete-btn" 
        (click)="deleteTask(todoItem.id)"
        title="Delete task"
      >
        Delete
      </button>
    </li>
  </ul>
  
  <div class="empty-state" *ngIf="todoList.length === 0">
    <p>No tasks yet. Add one above to get started!</p>
  </div>
  
  <div class="stats" *ngIf="todoList.length > 0">
    <p>
      {{ getCompletedCount() }} of {{ todoList.length }} tasks completed
      <span *ngIf="getCompletedCount() === todoList.length"> ðŸŽ‰</span>
    </p>
  </div>

  <!-- AI Chat Button -->
  <button 
    class="chat-toggle-btn" 
    (click)="toggleChat()"
    [class.active]="isChatOpen"
  >
    <span *ngIf="!isChatOpen">ðŸ’¬ AI Chat</span>
    <span *ngIf="isChatOpen">âœ• Close</span>
  </button>

  <!-- AI Chat Box -->
  <div class="chat-container" [class.open]="isChatOpen">
    <div class="chat-header">
      <h3>AI Assistant</h3>
      <button class="chat-close" (click)="toggleChat()">âœ•</button>
    </div>
    
    <div class="chat-messages" #chatMessagesContainer>
      <div 
        *ngFor="let message of chatMessages; trackBy: trackChatByFn" 
        class="chat-message"
        [class.user]="message.isUser"
        [class.ai]="!message.isUser"
      >
        <div class="message-content">
          <p>{{ message.content }}</p>
          <small class="timestamp">{{ message.timestamp | date:'short' }}</small>
        </div>
      </div>
      
      <!-- Loading indicator -->
      <div *ngIf="isLoading" class="chat-message ai">
        <div class="message-content">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="chat-input">
      <input
        type="text"
        [(ngModel)]="newMessage"
        placeholder="Ask me anything or say 'add task: buy milk'"
        (keyup.enter)="sendMessage()"
        [disabled]="isLoading"
      >
      <button 
        (click)="sendMessage()"
        [disabled]="!newMessage.trim() || isLoading"
        class="send-btn"
      >
        <span *ngIf="!isLoading">Send</span>
        <span *ngIf="isLoading">...</span>
      </button>
    </div>
  </div>
</main>

<router-outlet />